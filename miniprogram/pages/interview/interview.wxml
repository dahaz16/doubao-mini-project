<view class="container">
  <!-- Top 区：AI 虚拟形象 -->
  <view class="top-section">
    <image class="ai-avatar" src="/images/AI_Avatar.png" mode="aspectFit"></image>
  </view>

  <!-- Middle 区：AI 字幕气泡 -->
  <view class="middle-section">
    <view class="ai-subtitle-bubble {{status === 'thinking' ? 'thinking-bubble' : ''}}">
      <scroll-view scroll-y="true" scroll-into-view="{{scrollToView}}" class="ai-subtitle-scroll">
        <view>
          <text class="ai-subtitle-text {{status === 'thinking' ? 'thinking' : ''}}">{{status === 'thinking' ? '思考中...' : aiMessage}}</text>
          <view id="subtitle-bottom"></view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- Bottom 区：用户输入区 -->
  <view class="bottom-section">
    <!-- 用户字幕气泡（录音时显示实时识别结果）-->
    <view class="user-subtitle-bubble" wx:if="{{userInput && status === 'recording'}}">
      <text class="user-subtitle-text">{{userInput}}</text>
    </view>

    <!-- 控制按钮组 -->
    <view class="control-buttons">
      <!-- ===== 默认状态：讲述按钮(长条) + 键盘按钮(右侧) ===== -->
      <block wx:if="{{status === 'idle'}}">
        <button class="narration-btn" bindtap="handleMicToggle">
          <image class="mic-icon" src="/images/microphone.png" mode="aspectFit"></image>
          <text>讲述</text>
        </button>
        <button class="circle-btn" bindtap="handleSwitchToKeyboard">
          <image src="/images/switch_to_keyboard_btn.png" mode="aspectFit"></image>
        </button>
      </block>

      <!-- ===== 录音状态：取消(左) + 音频指示器(中) + 发送(右) ===== -->
      <block wx:if="{{status === 'recording'}}">
        <button class="circle-btn cancel-btn" bindtap="handleCancelRecording">
          <text class="cancel-icon">×</text>
        </button>
        <view class="voice-indicator">
          <view class="voice-waveform">
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
            <view class="wave-bar"></view>
          </view>
          <text class="voice-timer">{{recordingTime}}</text>
        </view>
        <button class="circle-btn send-btn" bindtap="handleMicToggle">
          <text class="send-icon">↑</text>
        </button>
      </block>

      <!-- ===== 思考中状态：禁用讲述按钮 + 禁用键盘按钮 ===== -->
      <block wx:if="{{status === 'thinking'}}">
        <button class="narration-btn disabled" disabled>
          <image class="mic-icon" src="/images/microphone.png" mode="aspectFit"></image>
          <text>讲述</text>
        </button>
        <button class="circle-btn disabled" disabled>
          <image src="/images/switch_to_keyboard_btn_disabled.png" mode="aspectFit"></image>
        </button>
      </block>

      <!-- ===== AI说话状态：与默认状态相同 ===== -->
      <block wx:if="{{status === 'talking'}}">
        <button class="narration-btn" bindtap="handleMicToggle">
          <image class="mic-icon" src="/images/microphone.png" mode="aspectFit"></image>
          <text>讲述</text>
        </button>
        <button class="circle-btn" bindtap="handleSwitchToKeyboard">
          <image src="/images/switch_to_keyboard_btn.png" mode="aspectFit"></image>
        </button>
      </block>
    </view>
  </view>
</view>
